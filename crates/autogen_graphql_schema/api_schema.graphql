# AUTOGENERATED. DO NOT MODIFY. ALL CHANGES WILL BE LOST.

"""
Metadata that was collected during a bisection run.
"""
type BisectionReport {
	"""
	The block number and hash that this metadata pertains to.
	"""
	block: PartialBlock!
	"""
	The metadata that was collected from the first indexer's
	`graph-node` instance.
	"""
	indexer1Response: String!
	"""
	The metadata that was collected from the second indexer's
	`graph-node` instance.
	"""
	indexer2Response: String!
}

"""
A bisection run report contains information about a specific bisection
run that is part of a larger divergence investigation.
"""
type BisectionRunReport {
	"""
	The UUID of the bisection run that this report pertains to. This UUID
	is different from the UUID of the parent divergence investigation
	request.
	"""
	uuid: UUID!
	"""
	The first PoI that was used to start the bisection run.
	"""
	poi1: HexString!
	"""
	The second PoI that was used to start the bisection run.
	"""
	poi2: HexString!
	"""
	The lower and upper block bounds inside which the bisection run
	occurred.
	"""
	divergenceBlockBounds: DivergenceBlockBounds!
	"""
	For each specific bisection, a list of bisection reports is
	available which includes the block number and hash, as well as the
	metadata that was collected from `graph-node` for that block.
	"""
	bisects: [BisectionReport!]!
	"""
	If the bisection run failed before reaching a conclusion at a single
	block, this field contains the error message.
	"""
	error: String
}

type Block {
	"""
	Returns an estimate of the timestamp of the block, based on the
	network's block speed and the block's number.
	"""
	estimatedTimestamp: DateTime
	"""
	Returns an URL to a block explorer page for the block, if configured.
	"""
	blockExplorerUrl: String
	"""
	The block number (a.k.a. height).
	"""
	number: Int!
	"""
	The block hash, expressed as a hex string with a '0x' prefix.
	"""
	hash: HexString!
	"""
	The network that this block belongs to.
	"""
	network: Network!
}

"""
A block range, specified by optional start and end block numbers.
"""
input BlockRange {
	"""
	The start block number (inclusive).
	"""
	start: Int
	"""
	The end block number (inclusive).
	"""
	end: Int
}


"""
Implement the DateTime<Utc> scalar

The input/output is a string in RFC3339 format.
"""
scalar DateTime

type Deployment {
	id: String!
}

type DivergenceBlockBounds {
	lowerBound: PartialBlock!
	upperBound: PartialBlock!
}

"""
A divergence investigation report contains all information that pertains to a divergence
investigation, including the results of its bisection run(s).
"""
type DivergenceInvestigationReport {
	"""
	The UUID of the divergence investigation request that this report
	pertains to. This UUID is also used to identify the report, as well
	as the request.
	"""
	uuid: UUID!
	"""
	The latest known status of the divergence investigation.
	"""
	status: DivergenceInvestigationStatus!
	"""
	A list of bisection runs that were performed as part of this
	divergence investigation. If the investigation is still in progress,
	this list may be incomplete.
	"""
	bisectionRuns: [BisectionRunReport!]!
	"""
	If the divergence investigation failed altogether, this field
	contains the error message. Please note that specific bisection runs
	may also fail, in which case the error message will be in the
	`error` field of the corresponding `BisectionRunReport`.
	"""
	error: String
}

"""
Once Graphix launches a PoI divergence investigation, its status value
can be one of these.
"""
enum DivergenceInvestigationStatus {
	"""
	The investigation has been requested, but not yet launched and it's
	scheduled to be launched soon.
	"""
	PENDING
	"""
	The investigation has been launched, some requests have possibly
	been sent already, but the investigation is not concluded. Some
	information may be available already, but partial.
	"""
	IN_PROGRESS
	"""
	The investigation has been concluded and the end results are
	available.
	"""
	COMPLETE
}


type GraphNodeCollectedVersion {
	versionString: String
	versionCommit: String
	errorResponse: String
	collectedAt: NaiveDateTime!
}

scalar HexString


type Indexer {
	address: String!
	defaultDisplayName: String
	"""
	The version of the indexer.
	"""
	graphNodeVersion: GraphNodeCollectedVersion
	"""
	The network subgraph metadata of the indexer.
	"""
	networkSubgraphMetadata: IndexerNetworkSubgraphMetadata
}

type IndexerNetworkSubgraphMetadata {
	geohash: String
	indexerUrl: String
	stakedTokens: Float!
	allocatedTokens: Float!
	lockedTokens: Float!
	queryFeesCollected: Float!
	queryFeeRebates: Float!
	rewardsEarned: Float!
	indexerIndexingRewards: Float!
	delegatorIndexingRewards: Float!
	lastUpdatedAt: NaiveDateTime!
}


scalar IpfsCid

type MutationRoot {
	"""
	Launches a divergence investigation, which is a process of comparing
	two or more PoIs (up to four) and running a binary search to find the first
	diverging block.
	"""
	launchDivergenceInvestigation(
		"""
		A list of PoI hashes that should be investigated for divergence. If this list contains more than two PoIs, a new bisection run will be performed for each unordered pair of PoIs.
		"""
		pois: [HexString!]!,
		"""
		Indicates whether to collect `graph-node`'s block cache contents during bisection runs to include in the report.
		"""
		queryBlockCaches: Boolean! = true,
		"""
		Indicates whether to collect `graph-node`'s ETH call cache contents during bisection runs to include in the report.
		"""
		queryEthCallCaches: Boolean! = true,
		"""
		Indicates whether to collect `graph-node`'s entity changes during bisection runs to include in the report.
		"""
		queryEntityChanges: Boolean! = true
	): DivergenceInvestigationReport!
	"""
	Create a new API key with the given permission level. You'll need to
	authenticate with another API key with the `admin` permission level to
	do this.
	"""
	createApiKey(
		"""
		Permission level of the API key. Use `admin` for full access.
		"""
		permissionLevel: String!,
		"""
		Not-encrypted notes to store in the database alongside the API key, to be used for debugging or identification purposes.
		"""
		notes: String = null
	): NewlyCreatedApiKey!
	deleteApiKey(apiKey: String!): Boolean!
	modifyApiKey(		apiKey: String!,
		"""
		Not-encrypted notes to store in the database alongside the API key, to be used for debugging or identification purposes.
		"""
		notes: String,		permissionLevel: String!
	): Boolean!
	setDeploymentName(deploymentIpfsCid: String!, name: String!): Deployment!
	"""
	Completely deletes a network and all related data (PoIs, indexers, subgraphs, etc.).
	"""
	deleteNetwork(network: String!): String!
}

"""
ISO 8601 combined date and time without timezone.

# Examples

* `2015-07-01T08:59:60.123`,
"""
scalar NaiveDateTime

type Network {
	"""
	Human-readable name of the network, following The Graph naming
	standards.
	"""
	name: String!
	"""
	CAIP-2 chain ID of the network, if it exists.
	"""
	caip2: String
}

type NewlyCreatedApiKey {
	apiKey: String!
	notes: String
	permissionLevel: String!
}

"""
A block number that may or may not also have an associated hash.
"""
type PartialBlock {
	"""
	The block number (or height).
	"""
	number: Int!
	"""
	The block hash, if known. Expressed as a hex string with a '0x' prefix.
	"""
	hash: HexString
}

"""
A specific indexer can use `PoiAgreementRatio` to check in how much agreement it is with other
indexers, given its own poi for each deployment. A consensus currently means a majority of
indexers agreeing on a particular POI.
"""
type PoiAgreementRatio {
	"""
	Total number of indexers that have live pois for the deployment.
	"""
	totalIndexers: Int!
	"""
	Number of indexers that agree on the POI with the specified indexer,
	including the indexer itself.
	"""
	nAgreeingIndexers: Int!
	"""
	Number of indexers that disagree on the POI with the specified indexer.
	"""
	nDisagreeingIndexers: Int!
	"""
	Indicates if a consensus on the POI exists among indexers.
	"""
	hasConsensus: Boolean!
	"""
	Indicates if the specified indexer's POI is part of the consensus.
	"""
	inConsensus: Boolean!
	"""
	The PoI in question.
	"""
	poi: ProofOfIndexing!
}

"""
A filter for PoIs (proofs of indexing).
"""
input PoisQuery {
	"""
	Restricts the query to PoIs for subgraph deployments that index the
	given chain name.
	"""
	network: String
	"""
	Restricts the query to PoIs for these given subgraph deployment IDs.
	"""
	deployments: [IpfsCid!]!
	"""
	Restricts the query to PoIs that were collected in the given block
	range.
	"""
	blockRange: BlockRange
	"""
	Upper limit on the number of shown results.
	"""
	limit: Int
}

type ProofOfIndexing {
	"""
	The block height and hash for which this PoI is valid.
	"""
	block: Block!
	"""
	The PoI's hash.
	"""
	hash: HexString!
	"""
	The subgraph deployment that this PoI is for.
	"""
	deployment: SubgraphDeployment!
	"""
	The indexer that produced this PoI.
	"""
	indexer: Indexer!
}

type QueryRoot {
	"""
	Fetches all tracked subgraph deploymens in this Graphix instance and
	filters them according to some filtering rules.
	"""
	deployments(
		"""
		The network name of the subgraph deployments to fetch
		"""
		networkName: String,		name: String,		ipfsCid: IpfsCid,
		"""
		Upper limit on the number of shown results.
		"""
		limit: Int! = 100
	): [SubgraphDeployment!]!
	"""
	Fetches all tracked indexers in this Graphix instance and filters them
	according to some filtering rules.
	"""
	indexers(
		"""
		The address of the indexer, encoded as a hex string with a '0x' prefix
		"""
		address: HexString,
		"""
		Upper limit on the number of shown results.
		"""
		limit: Int! = 100
	): [Indexer!]!
	"""
	Filters through all PoIs ever collected by this Graphix
	instance, according to some filtering rules specified in `filter`.
	"""
	proofsOfIndexing(
		"""
		Restricts the query to PoIs for subgraph deployments that index the given chain name.
		"""
		network: String,
		"""
		Restricts the query to PoIs for these given subgraph deployments (by hex-encoded IPFS CID with '0x' prefix).
		"""
		deployments: [IpfsCid!]! = [],
		"""
		Restricts the query to PoIs that were collected in the given block range.
		"""
		blockRange: BlockRange,
		"""
		Upper limit on the number of shown results.
		"""
		limit: Int! = 100
	): [ProofOfIndexing!]!
	"""
	Same as [`QueryRoot::proofs_of_indexing`], but only returns PoIs that
	are "live" i.e. they are the most recent PoI collected for their
	subgraph deployment.
	"""
	liveProofsOfIndexing(filter: PoisQuery!): [ProofOfIndexing!]!
	poiAgreementRatios(indexerAddress: HexString!): [PoiAgreementRatio!]!
	divergenceInvestigationReport(
		"""
		The UUID of the divergence investigation report to fetch. This is the UUID that was returned by the `launchDivergenceInvestigation` mutation.
		"""
		uuid: UUID!
	): DivergenceInvestigationReport
	"""
	Returns all networks known to Graphix. Subgraphs indexing other networks
	won't be available in this Graphix database.
	"""
	networks: [Network!]!
	_service: _Service!
}


type SubgraphDeployment {
	"""
	IPFS CID of the subgraph deployment manifest e.g. `Qm...`.
	"""
	cid: IpfsCid!
	"""
	Human-readable name of the subgraph deployment, if present.
	"""
	name: String
	"""
	Network of the subgraph deployment.
	"""
	network: Network!
}

"""
A UUID is a unique 128-bit number, stored as 16 octets. UUIDs are parsed as
Strings within GraphQL. UUIDs are used to assign unique identifiers to
entities without requiring a central allocating authority.

# References

* [Wikipedia: Universally Unique Identifier](http://en.wikipedia.org/wiki/Universally_unique_identifier)
* [RFC4122: A Universally Unique IDentifier (UUID) URN Namespace](http://tools.ietf.org/html/rfc4122)
"""
scalar UUID

"""
The `_Any` scalar is used to pass representations of entities from external
services into the root `_entities` field for execution.
"""
scalar _Any

type _Service {
	sdl: String
}

directive @include(if: Boolean!) on FIELD | FRAGMENT_SPREAD | INLINE_FRAGMENT
directive @skip(if: Boolean!) on FIELD | FRAGMENT_SPREAD | INLINE_FRAGMENT
schema {
	query: QueryRoot
	mutation: MutationRoot
}
